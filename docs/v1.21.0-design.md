# Course Engine v1.21.0 — Design Record
## Governance Snapshot Contract

**Status:** Proposed / In progress  
**Release target:** v1.21.0  
**Preceding release:** v1.20.0 (Preflight diagnostic contract)

---

## 1. Purpose

Version v1.21.0 introduces a **governance snapshot contract** for the Course Engine.

The purpose of this release is to provide a **stable, deterministic, non‑evaluative summary of course state** that can be:

- generated programmatically
- compared across runs and versions
- exchanged in institutional workflows
- used safely in CI and governance contexts

This release does **not** introduce new validation rules, quality judgements, or enforcement behaviour.
It formalises *facts about course state*, not verdicts.

---

## 2. Design Context

v1.20.0 established a contract‑stable **preflight diagnostic interface** (`course-engine check`),
making the runtime environment safe to automate.

v1.21.0 builds on that foundation by answering a different institutional question:

> “What is the current, inspectable state of this course, in a form that can be compared and archived?”

The snapshot contract sits **between** rich explainability and policy enforcement:

| Layer | Role |
|-----|-----|
| check | Runtime readiness |
| snapshot | Stable course state facts |
| explain | Deep, human‑readable inspection |
| report | Declared coverage summaries |
| validate | Policy‑based rule checking |

---

## 3. Core Feature: Governance Snapshot

### 3.1 Snapshot definition

A **snapshot** is a minimal, structured summary describing:

- what inputs were provided
- what declarations are present
- which governance‑relevant components exist
- which policy configuration was resolved
- stable hashes representing those components

Snapshots are:

- **non‑evaluative**
- **diff‑friendly**
- **contract‑stable**
- **deterministic** (timestamps aside)

---

## 4. CLI Interface

### Command

```bash
course-engine snapshot PATH --format json|text [--out FILE]
```

### Behaviour

- PATH may point to:
  - a `course.yml` source file, or
  - a built artefact directory containing `manifest.json`
- No build or validation is performed
- Failures are reported explicitly; no silent fallback behaviour is introduced

---

## 5. Snapshot JSON Contract (v1)

The snapshot output is governed by a versioned contract.

```json
{
  "mode": "snapshot",
  "contract_version": "1",
  "generated_at_utc": "...",
  "input": {
    "kind": "source|artefact",
    "path": "...",
    "course_id": "..."
  },
  "versioning": {
    "course_engine_version": "1.21.0",
    "quarto_version": "...",
    "pandoc_version": "..."
  },
  "hashes": {
    "course_yml_hash": "...",
    "design_intent_hash": "...",
    "ai_scoping_hash": "...",
    "policy_profile_hash": "..."
  },
  "declared": {
    "framework_alignment_present": true,
    "capability_mapping_present": true,
    "design_intent_present": true,
    "ai_scoping_present": true
  },
  "signals": {
    "absence": [],
    "notes": []
  },
  "policy": {
    "policy_file": "...",
    "profile": "...",
    "effective_hash": "..."
  }
}
```

### Contract rules

- Field names and structure are stable within a contract version
- Ordering is deterministic
- No qualitative judgements are included
- Hashes are computed over canonicalised content only

---

## 6. Determinism Guarantees

For identical inputs and configuration:

- snapshot output is byte‑stable after removal of timestamps
- hash values are stable across runs
- missing components are represented explicitly, not inferred

This property is required for CI usage and governance diffing.

---

## 7. Policy Resolution Transparency

v1.21.0 surfaces **policy resolution facts** only:

- policy file path
- selected profile
- stable hash of effective policy configuration

No enforcement decisions are made at snapshot time.

---

## 8. Explicit Non‑Goals

v1.21.0 deliberately does **not**:

- score quality or compliance
- enforce design intent or AI scoping presence
- auto‑fix or mutate inputs
- introduce AI‑generated judgements
- replace human governance processes

The snapshot is informational by design.

---

## 9. Acceptance Criteria

This release is complete when:

1. Snapshot output conforms to the documented contract.
2. Identical inputs produce diff‑stable snapshots.
3. Snapshots can be generated from source inputs.
4. Policy resolution is transparent in snapshot output.
5. Documentation clearly distinguishes snapshot from explain and validate.

---

## 10. Design Principle

> The Course Engine reports facts.  
> Humans remain responsible for interpretation and judgement.

This principle remains unchanged in v1.21.0.
