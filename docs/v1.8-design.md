# v1.8 Design: Explainability, Diffing, and Policy Composition (Explain-Only)

**Status:** Draft  
**Version target:** v1.8.0  
**Last updated:** YYYY-MM-DD  
**Owner:** Jonathan Wong  
**Scope tags:** explain, diff, policy, governance, json

---

## 1. Purpose

The purpose of v1.8 is to activate **governance-facing explainability** within the Course Engine without altering its core role as a deterministic compiler.

While earlier releases focused on stabilising authoring workflows, structural contracts, and reproducible builds, v1.8 addresses a different need: enabling reviewers, QA teams, and institutional stakeholders to **understand, compare, and interrogate course artefacts** produced by the engine.

Specifically, v1.8 introduces explain-only capabilities that answer questions such as:

- Why does this course have this structure?
- What inputs, sources, and policies influenced the generated outputs?
- What changed between two versions of a course?
- What would fail or raise concerns under stricter policy conditions?

v1.8 does not introduce new authoring requirements, enforce policy, or automate judgement. Its role is to surface evidence and rationale in a form suitable for governance, audit, and review.

---

## 2. Project anchor

> The Course Engine compiles courses into inspectable artefacts.  
> Future releases focus on explaining, comparing, and reviewing those artefacts —  
> not automating educational judgement.

This anchor remains unchanged from v1.7 and continues to define the system boundary.

The Course Engine is a compiler and evidence system. v1.8 extends its value by making the outcomes of compilation **explicit, legible, and reviewable**, while preserving human decision-making authority.

---

## 3. Design principles

v1.8 is guided by the following principles:

- **Explain-only by design**  
  All new functionality surfaces information without enforcing rules, blocking builds, or modifying artefacts.

- **Determinism over intelligence**  
  Outputs must be reproducible, stable, and traceable to inputs. No inference or heuristic reasoning is introduced.

- **Additive, non-breaking change**  
  Existing authoring workflows, schemas, CLI commands, and templates remain valid and unchanged.

- **Separation of concerns**  
  Compilation, explanation, diffing, and policy reasoning are distinct layers. The generator compiles; the explain layer observes.

- **Machine-readable first**  
  JSON outputs are treated as primary artefacts, suitable for CI, dashboards, and downstream tooling.

- **Governance readiness**  
  Outputs must support audit, review, approval, and discussion in institutional contexts.

---

## 4. Non-goals

v1.8 explicitly does not attempt to:

- Enforce institutional or academic policy
- Block builds based on policy or validation outcomes
- Infer pedagogical quality, alignment, or effectiveness
- Introduce agentic or autonomous decision-making
- Track learners, assessments, or engagement
- Replace LMS, QA systems, or approval workflows
- Modify rendering templates or UI behaviour
- Introduce schema-breaking changes or new required fields

Any functionality that would move the engine from **explaining** into **deciding** is out of scope.

---

## 5. User stories

The following user stories define the intended value of v1.8:

- **QA Lead**  
  “I want a structured JSON explanation of how this course was built so I can review structure, provenance, and outputs without reading source files.”

- **Programme Reviewer**  
  “I want to see what changed between two versions of a course so I can focus my review on meaningful differences.”

- **Governance Panel Member**  
  “I want to know what policy issues might arise if stricter rules were applied, without blocking the current build.”

- **DevOps / CI Pipeline**  
  “I want stable, machine-readable outputs that can feed dashboards, reports, or approval workflows.”

- **Course Owner**  
  “I want evidence that my course outputs are reproducible, traceable, and aligned with declared intent.”

These stories prioritise **review, explanation, and evidence**, not automation.

---

## 6. v1.8 scope summary

v1.8 introduces three tightly scoped, explain-only capabilities:

1. **Course explainability**  
   The ability to generate a structured explanation of a course from `course.yml` and/or compiled artefacts, covering structure, provenance, rendering decisions, and outputs.

2. **Course diffing**  
   The ability to compare two course versions and surface structural, metadata, source, and policy-context changes in a deterministic JSON format.

3. **Policy composition (explain-only)**  
   The ability to resolve layered policies (institutional, faculty, course) and report hypothetical outcomes such as “would fail” or “would warn” under stricter conditions, without enforcement.

Together, these capabilities position the Course Engine as a **transparent, reviewable, and governance-aligned system**, while preserving its core identity as a deterministic compiler rather than a decision-making tool.

---

## 7. Commands and interfaces

### 7.1 Proposed CLI commands

- `course-engine explain <course.yml|dist_dir> --json [--out file]`
- `course-engine diff <a> <b> --json [--out file]`
- `course-engine policy resolve --policy <path> --course <path> --json` (optional)

### 7.2 Backward compatibility

- No breaking changes to existing commands
- No mandatory schema changes
- Existing workflows continue unchanged

---

## 8. Explainability artefact design

### 8.1 Explain targets

- `course.yml` (author intent)
- `dist/<course>/manifest.json` and generated artefacts
- Rules for source-of-truth precedence

### 8.2 Explain JSON schema (high-level)

- Stable top-level keys
- Explicit schema version
- Required vs optional fields clearly defined
- Deterministic ordering of keys and arrays

### 8.3 Explain content categories

- Course identity and metadata
- Structural layout (modules, lessons)
- Lesson sources and provenance (paths, hashes)
- Rendering profile resolution and rationale
- Policy context and hypothetical outcomes
- Generated outputs and formats
- Warnings and known limitations

### 8.4 Error and warning model

- Explain should succeed with partial information where possible
- Errors and warnings are returned as structured lists
- No hard failure unless input is unreadable

---

## 9. Diff semantics

### 9.1 Diff targets

- `course.yml` vs `course.yml`
- `dist/manifest.json` vs `dist/manifest.json`
- Mixed-mode diffing (if supported) must be explicit

### 9.2 Diff categories

- Structural changes (add/remove/reorder modules or lessons)
- Metadata changes (titles, durations, tags, labels)
- Source changes (hash or path changes)
- Output profile or template changes
- Policy set or resolution changes

### 9.3 Diff JSON schema (high-level)

- Summary of changes
- Typed change records
- Advisory review flags (non-enforcing)
- Deterministic ordering

---

## 10. Policy composition (explain-only)

### 10.1 Policy layering model

- Institutional policies
- Faculty or department policies
- Course-level policies
- Precedence and override rules

### 10.2 Explain-only outcomes

- Checks that would fail under strict enforcement
- Checks that would trigger warnings
- Checks that are satisfied
- No build blocking or mutation

### 10.3 Relationship to existing policy utilities

- Interaction with `utils/policy.py`
- Use of presets and example policies
- No duplication of enforcement logic

---

## 11. Architecture and code placement

- New explain-related modules live outside the generator
- Existing compilation logic remains unchanged
- No policy or explain logic embedded in templates
- Clear boundaries between build, explain, diff, and policy layers

---

## 12. Output stability and determinism

- Stable key ordering
- Stable identifiers
- Normalised paths
- Explicit handling of timestamps
- Schema versioning strategy

---

## 13. Acceptance criteria

- Explain produces JSON for both `course.yml` and `dist/`
- Diff identifies structural, metadata, and source changes
- Policy composition is surfaced in explain-only form
- No changes to existing build outputs
- New tests cover explain, diff, and policy resolution

---

## 14. Risks and mitigations

- Risk of scope creep into enforcement  
  Mitigation: explicit explain-only language and tests

- Risk of non-deterministic outputs  
  Mitigation: strict ordering and normalisation rules

- Risk of overfitting to demo courses  
  Mitigation: diverse test fixtures

---

## 15. Alternatives considered

- External-only tooling (agents or pipelines)
- Git-based diffing alone
- Embedding explanation solely in manifests

Explain why these were insufficient.

---

## 16. Rollout plan

- Draft design and skeleton modules
- Implement explain for `course.yml`
- Implement explain for `dist/` artefacts
- Implement diff semantics
- Surface policy composition results
- Expand test coverage

---

## 17. Out of scope for v1.9+

- Naming consolidation (Course Builder vs Course Engine)
- Handbook and end-user instruction refresh
- Enforcement modes
- Dashboards or CI templates (external tooling)

---

## 18. Appendix

- Example explain JSON snippets
- Example diff JSON snippets
- Mapping tables (`course.yml` → explain output)
- Glossary of terms
