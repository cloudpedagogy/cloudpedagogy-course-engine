---
title: "{{ current.lesson_nav_title if (current is defined and current.lesson_nav_title is defined) else (current.lesson_title if current is defined else lesson.title) }}"
toc: true
toc-depth: 2
toc-location: body
---

{# ------------------------------------------------------------------------- #}
{# Resolve the real lesson + module objects                                   #}
{# ------------------------------------------------------------------------- #}

{% if lesson is defined %}
  {% set lesson_obj = lesson %}
  {% set module_obj = module %}
{% else %}
  {% set module_obj = (spec.modules | selectattr("id", "equalto", current.module_id) | first) %}
  {% set lesson_obj = (module_obj.lessons | selectattr("id", "equalto", current.lesson_id) | first) %}
{% endif %}

{# --------------------------- Lesson details -------------------------------- #}

::: {.callout-note}
## Lesson details
{% if lesson_obj.duration is defined and lesson_obj.duration %}
Estimated time: {{ lesson_obj.duration }} minutes  
{% endif %}

{% if lesson_obj.tags is defined and lesson_obj.tags %}
Tags: {{ lesson_obj.tags | join(", ") }}
{% endif %}

{% if lesson_obj.display_label is defined and lesson_obj.display_label %}
Label: {{ lesson_obj.display_label }}
{% endif %}
:::

{# ------------------------- Next / Previous --------------------------------- #}
{# Navigation should NOT be a callout (avoids the "Tip" label).                #}
{# IMPORTANT: lesson pages live in /lessons/, so links must be local filenames #}

{% if prev_item is defined or next_item is defined %}
{% set navline = "" %}

{% if prev_item %}
{% set prev_filename = prev_item.href.split("/")[-1] %}
{% set prev_title = (prev_item.lesson_nav_title if prev_item.lesson_nav_title is defined else prev_item.lesson_title) %}
{% set navline = navline ~ "← [Previous: " ~ prev_title ~ "](" ~ prev_filename ~ ")" %}
{% endif %}

{% if prev_item and next_item %}
{% set navline = navline ~ " | " %}
{% endif %}

{% if next_item %}
{% set next_filename = next_item.href.split("/")[-1] %}
{% set next_title = (next_item.lesson_nav_title if next_item.lesson_nav_title is defined else next_item.lesson_title) %}
{% set navline = navline ~ "[Next: " ~ next_title ~ "](" ~ next_filename ~ ") →" %}
{% endif %}

{{ navline }}

{% endif %}

{# ------------------------ Learning objectives ------------------------------ #}

## Learning objectives
{% if lesson_obj.learning_objectives %}
{% for lo in lesson_obj.learning_objectives %}
- {{ lo }}
{% endfor %}
{% else %}
- (Add learning objectives)
{% endif %}

{# -------------------------------- Content --------------------------------- #}
{# NOTE: no "## Content" heading — avoids redundant TOC entries on the right. #}

{% if lesson_obj.content_blocks %}
{% for b in lesson_obj.content_blocks %}
  {% if b.audience == "learner" %}

    {% if b.type == "markdown" %}
{{ b.body or "" }}

    {% elif b.type == "callout" %}
::: {.callout-{{ b.style or "note" }}}
{% if b.title %}## {{ b.title }}{% endif %}
{{ b.body or "" }}
:::

    {% elif b.type == "quiz" %}
### Knowledge check

**{{ b.prompt }}**

{% for opt in b.options %}
- {{ opt }}
{% endfor %}

{% if b.answer is not none or b.solution %}
<details>
  <summary><strong>Show answer</strong></summary>

  {% if b.answer is not none %}
  **Answer:** {{ b.options[b.answer] if b.options and b.answer < (b.options|length) else b.answer }}
  {% endif %}

  {% if b.solution %}
  {{ b.solution }}
  {% endif %}
</details>
{% endif %}

    {% elif b.type == "reflection" %}
### Reflection
{{ b.prompt or "" }}

    {% elif b.type == "submission" %}
### Submission
{{ b.prompt or "" }}

    {% endif %}
  {% endif %}
{% endfor %}
{% endif %}

{# ---------------------------- Instructor notes ----------------------------- #}

{% set instructor_blocks = [] %}
{% if lesson_obj.content_blocks %}
  {% for b in lesson_obj.content_blocks %}
    {% if b.audience == "instructor" %}
      {% set _ = instructor_blocks.append(b) %}
    {% endif %}
  {% endfor %}
{% endif %}

{% if instructor_blocks %}
::: {.callout-important}
## Instructor notes
{% for b in instructor_blocks %}

{% if b.type == "markdown" %}
{{ b.body or "" }}

{% elif b.type == "callout" %}
::: {.callout-{{ b.style or "note" }}}
{% if b.title %}## {{ b.title }}{% endif %}
{{ b.body or "" }}
:::

{% elif b.type == "quiz" %}
**Knowledge check (answer key):** {{ b.prompt }}

{% if b.options %}
Options:
{% for opt in b.options %}
- {{ opt }}
{% endfor %}
{% endif %}

{% if b.answer is not none %}
**Answer:** {{ b.answer + 1 }}
{% endif %}

{% if b.solution %}
{{ b.solution }}
{% endif %}

{% elif b.type == "reflection" %}
**Reflection prompt (facilitation):** {{ b.prompt or "" }}

{% elif b.type == "submission" %}
**Submission guidance:** {{ b.prompt or "" }}

{% endif %}

{% endfor %}
:::
{% endif %}

{# -------------------------------- Readings -------------------------------- #}

{% if lesson_obj.readings is defined and lesson_obj.readings %}
## Readings

{% for r in lesson_obj.readings %}
- {% if r.required %}(Required){% else %}(Optional){% endif %}
  {% if r.url %}
  [{{ r.title }}]({{ r.url }})
  {% else %}
  {{ r.title }}
  {% endif %}
{% endfor %}
{% endif %}

---

### Framework alignment
This lesson sits within: **{{ spec.framework_name }}**  
Domains: {% for d in spec.domains %}{{ d }}{% if not loop.last %}, {% endif %}{% endfor %}

---

{# ------------------------- Next / Previous --------------------------------- #}
{# Navigation should NOT be a callout (avoids the "Tip" label).                #}
{# IMPORTANT: lesson pages live in /lessons/, so links must be local filenames #}

{% if prev_item is defined or next_item is defined %}
{% set navline = "" %}

{% if prev_item %}
{% set prev_filename = prev_item.href.split("/")[-1] %}
{% set prev_title = (prev_item.lesson_nav_title if prev_item.lesson_nav_title is defined else prev_item.lesson_title) %}
{% set navline = navline ~ "← [Previous: " ~ prev_title ~ "](" ~ prev_filename ~ ")" %}
{% endif %}

{% if prev_item and next_item %}
{% set navline = navline ~ " | " %}
{% endif %}

{% if next_item %}
{% set next_filename = next_item.href.split("/")[-1] %}
{% set next_title = (next_item.lesson_nav_title if next_item.lesson_nav_title is defined else next_item.lesson_title) %}
{% set navline = navline ~ "[Next: " ~ next_title ~ "](" ~ next_filename ~ ") →" %}
{% endif %}

{{ navline }}

{% endif %}
